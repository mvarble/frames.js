<!doctype html>
<html>
  <head>
    <title>frames.js Examples</title>
    <meta charset="utf-8">
  </head>
  <body>
    <div id="examples" style="display: flex; flex-wrap: wrap; flex-direction: column; max-height: 1000px;"></div>
    <div style="margin: 1em">
      <h3>Children Are Affected For Chaining</h3>
      <canvas style="border: solid 3px blue;" id="bigboy" width=800 height=400></canvas>
    </div>
    <script src="./node_modules/mathjs/dist/math.min.js"></script>
    <script src="./index.js"></script>
    <script>
      /**
      * this frame and matrix will be repeatedly reused
      */
      const relFrame = {
        type: 'frame',
        worldMatrix: math.matrix([
          [20, 20, 200],
          [20, -20, 150],
          [0, 0, 1]
        ]),
      };
      const startMatrix = math.matrix([[15, 0, 50], [0, -15, 200], [0, 0, 1]]);
      let k = 0;

      /**
      * translation examples
      */

      // in one's own coordinates
      let t1Frame = { type: 'frame', worldMatrix: startMatrix };
      const t1Cont = createCanvas('Translations in Personal Coordinates');
      setInterval(function () {
        let dir;
        switch (Math.floor(k / 5) % 4) {
          case 0: dir = [0, 1]; break;
          case 1: dir = [1, 0]; break;
          case 2: dir = [0, -1]; break;
          case 3: dir = [-1, 0]; break;
        };
        t1Frame = frames.translatedFrame(t1Frame, dir);
        drawFrames(t1Cont, t1Frame, relFrame);
        k++
      }, 100);

      // in relative coordinates
      let t2Frame = { type: 'frame', worldMatrix: startMatrix };
      const t2Cont = createCanvas('Translations in Relative Coordinates');
      setInterval(function () {
        let dir;
        switch (Math.floor(k / 5) % 4) {
          case 0: dir = [0, 1]; break;
          case 1: dir = [1, 0]; break;
          case 2: dir = [0, -1]; break;
          case 3: dir = [-1, 0]; break;
        };
        t2Frame = frames.translatedFrame(t2Frame, dir, relFrame);
        drawFrames(t2Cont, t2Frame, relFrame);
      }, 100);

      /**
      * rotation examples
      */

      // in one's own coordinates
      let r1Frame = { type: 'frame', worldMatrix: startMatrix };
      const r1Cont = createCanvas('Rotations in Personal Coordinates');
      setInterval(function() {
        r1Frame = frames.rotatedFrame(r1Frame, math.pi / 50);
        drawFrames(r1Cont, r1Frame, relFrame);
      }, 100);

      // in relative coordinates
      let r2Frame = { type: 'frame', worldMatrix: startMatrix };
      const r2Cont = createCanvas('Rotations in Relative Coordinates');
      setInterval(function() {
        r2Frame = frames.rotatedFrame(r2Frame, math.pi / 50, relFrame);
        drawFrames(r2Cont, r2Frame, relFrame);
      }, 100);

      /**
      * scale examples
      */

      // in one's own coordinates
      let s1Frame = { type: 'frame', worldMatrix: startMatrix };
      const s1Cont = createCanvas('Scale in Personal Coordinates');
      setInterval(function() {
        let S;
        switch (Math.floor(k / 10) % 2) {
          case 0: S = 0.9; break;
          case 1: S = 1/0.9; break;
        };
        s1Frame = frames.scaledFrame(s1Frame, [S, S])
        drawFrames(s1Cont, s1Frame, relFrame);
      }, 100);

      // in relative coordinates
      let s2Frame = { type: 'frame', worldMatrix: startMatrix };
      const s2Cont = createCanvas('Scale in Relative Coordinates');
      setInterval(function() {
        let S;
        switch (Math.floor(k / 10) % 2) {
          case 0: S = 0.9; break;
          case 1: S = 1/0.9; break;
        };
        s2Frame = frames.scaledFrame(s2Frame, [S, S], relFrame);
        drawFrames(s2Cont, s2Frame, relFrame);
      }, 100);

      /**
       * combination
       */
      let tree = {
        type: 'frame',
        worldMatrix: math.matrix([[20, 0, 300], [0, -20, 180], [0, 0, 1]]),
        children: [{
          type: 'frame',
          worldMatrix: math.matrix([[10, 0, 300], [0, -10, 60], [0, 0, 1]]),
          children: [{
            type: 'frame',
            worldMatrix: math.matrix([[10, 0, 320], [0, -10, 40], [0, 0, 1]]),
          }]
        }],
      };
      const bigCont = document.getElementById('bigboy').getContext('2d');
      bigCont.lineWidth = 3;
      setInterval(function() {
        let dir;
        switch (Math.floor(k / 10) % 2) {
          case 0: dir = [1, 0.5*Math.sin(k)]; break;
          case 1: dir = [-1, 0.5*Math.sin(k)]; break;
        };
        tree = frames.translatedFrame(tree, dir);
        tree.children[0] = frames.rotatedFrame(tree.children[0], math.pi / 25, tree);
        tree.children[0] = frames.rotatedFrame(tree.children[0], math.pi / 50);
        tree.children[0].children[0] = frames.rotatedFrame(tree.children[0].children[0], -math.pi / 15, tree.children[0]);
        bigCont.clearRect(0, 0, 800, 600);
        bigCont.strokeStyle = 'orange';
        drawFrame(bigCont, tree);
        bigCont.strokeStyle = 'blue';
        drawFrame(bigCont, tree.children[0]);
        bigCont.strokeStyle = 'gray';
        drawFrame(bigCont, tree.children[0].children[0]);
      }, 50);


      /**
      * helper functions
      */
      function drawFrame(context, frame) {
        const coords = frames.locsFrameTrans(
          [[0, 1], [0, 0], [1, 0]], 
          frame, 
          { worldMatrix: math.identity(3) }
        );
        context.beginPath();
        context.moveTo(...coords[0]);
        context.lineTo(...coords[1]);
        context.lineTo(...coords[2]);
        context.stroke();
      }

      function drawFrames(context, frame, relFrame) {
        context.clearRect(0, 0, 800, 600);
        context.strokeStyle = 'red';
        drawFrame(context, frame);
        context.strokeStyle = 'green';
        drawFrame(context, relFrame);
      }

      function createCanvas(text) {
        // create a div with a title
        const parent = document.createElement('div');
        const title = document.createElement('h3');
        parent.style.margin = '1em';
        title.innerHTML = text;
        parent.appendChild(title);

        // append the canvas
        const canvas = document.createElement('canvas');
        canvas.width = 400;
        canvas.height = 300;
        canvas.style.border = 'solid 3px blue';
        parent.appendChild(canvas);

        // mount the DOM
        document.getElementById('examples').appendChild(parent);

        // expose the canvas context
        const context = canvas.getContext('2d');
        context.lineWidth = 3;
        return context;
      }
    </script>
  </body>
</html>
